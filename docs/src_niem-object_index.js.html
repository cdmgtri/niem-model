<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/niem-object/index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Component.html">Component</a><ul class='methods'><li data-type='method'><a href="Component.html#.name">name</a></li><li data-type='method'><a href="Component.html#.prefix">prefix</a></li><li data-type='method'><a href="Component.html#.sortByName">sortByName</a></li><li data-type='method'><a href="Component.html#.sortByQName">sortByQName</a></li></ul></li><li><a href="Facet.html">Facet</a><ul class='methods'><li data-type='method'><a href="Facet.html#.route">route</a></li></ul></li><li><a href="LocalTerm.html">LocalTerm</a><ul class='methods'><li data-type='method'><a href="LocalTerm.html#.route">route</a></li></ul></li><li><a href="Model.html">Model</a><ul class='methods'><li data-type='method'><a href="Model.html#createRelease">createRelease</a></li><li data-type='method'><a href="Model.html#facet">facet</a></li><li data-type='method'><a href="Model.html#facets">facets</a></li><li data-type='method'><a href="Model.html#localTerms">localTerms</a></li><li data-type='method'><a href="Model.html#namespaces">namespaces</a></li><li data-type='method'><a href="Model.html#properties">properties</a></li><li data-type='method'><a href="Model.html#releases">releases</a></li><li data-type='method'><a href="Model.html#subProperties">subProperties</a></li><li data-type='method'><a href="Model.html#types">types</a></li></ul></li><li><a href="Namespace.html">Namespace</a><ul class='methods'><li data-type='method'><a href="Namespace.html#.sortByPrefix">sortByPrefix</a></li><li data-type='method'><a href="Namespace.html#.sortByStyle">sortByStyle</a></li><li data-type='method'><a href="Namespace.html#.sortByURI">sortByURI</a></li><li data-type='method'><a href="Namespace.html#createFacet">createFacet</a></li><li data-type='method'><a href="Namespace.html#createLocalTerm">createLocalTerm</a></li><li data-type='method'><a href="Namespace.html#createProperty">createProperty</a></li><li data-type='method'><a href="Namespace.html#createType">createType</a></li><li data-type='method'><a href="Namespace.html#facet">facet</a></li><li data-type='method'><a href="Namespace.html#facets">facets</a></li><li data-type='method'><a href="Namespace.html#localTerm">localTerm</a></li><li data-type='method'><a href="Namespace.html#localTerms">localTerms</a></li><li data-type='method'><a href="Namespace.html#properties">properties</a></li><li data-type='method'><a href="Namespace.html#property">property</a></li><li data-type='method'><a href="Namespace.html#subProperties">subProperties</a></li><li data-type='method'><a href="Namespace.html#subProperty">subProperty</a></li><li data-type='method'><a href="Namespace.html#type">type</a></li><li data-type='method'><a href="Namespace.html#types">types</a></li></ul></li><li><a href="NIEM.html">NIEM</a><ul class='methods'><li data-type='method'><a href="NIEM.html#createModel">createModel</a></li><li data-type='method'><a href="NIEM.html#createRelease">createRelease</a></li><li data-type='method'><a href="NIEM.html#facet">facet</a></li><li data-type='method'><a href="NIEM.html#facets">facets</a></li><li data-type='method'><a href="NIEM.html#localTerm">localTerm</a></li><li data-type='method'><a href="NIEM.html#localTerms">localTerms</a></li><li data-type='method'><a href="NIEM.html#model">model</a></li><li data-type='method'><a href="NIEM.html#models">models</a></li><li data-type='method'><a href="NIEM.html#namespace">namespace</a></li><li data-type='method'><a href="NIEM.html#namespaces">namespaces</a></li><li data-type='method'><a href="NIEM.html#properties">properties</a></li><li data-type='method'><a href="NIEM.html#property">property</a></li><li data-type='method'><a href="NIEM.html#release">release</a></li><li data-type='method'><a href="NIEM.html#releases">releases</a></li><li data-type='method'><a href="NIEM.html#subProperties">subProperties</a></li><li data-type='method'><a href="NIEM.html#subProperty">subProperty</a></li><li data-type='method'><a href="NIEM.html#type">type</a></li><li data-type='method'><a href="NIEM.html#types">types</a></li></ul></li><li><a href="NIEMObject.html">NIEMObject</a><ul class='methods'><li data-type='method'><a href="NIEMObject.html#add">add</a></li><li data-type='method'><a href="NIEMObject.html#checkBaselineFields">checkBaselineFields</a></li><li data-type='method'><a href="NIEMObject.html#checkSourceID">checkSourceID</a></li><li data-type='method'><a href="NIEMObject.html#delete">delete</a></li><li data-type='method'><a href="NIEMObject.html#hasBaselineFields">hasBaselineFields</a></li><li data-type='method'><a href="NIEMObject.html#save">save</a></li><li data-type='method'><a href="NIEMObject.html#updateSource">updateSource</a></li></ul></li><li><a href="Property.html">Property</a></li><li><a href="Release.html">Release</a><ul class='methods'><li data-type='method'><a href="Release.html#.route">route</a></li><li data-type='method'><a href="Release.html#createFacet">createFacet</a></li><li data-type='method'><a href="Release.html#createLocalTerm">createLocalTerm</a></li><li data-type='method'><a href="Release.html#createNamespace">createNamespace</a></li><li data-type='method'><a href="Release.html#createProperty">createProperty</a></li><li data-type='method'><a href="Release.html#createSubProperty">createSubProperty</a></li><li data-type='method'><a href="Release.html#createType">createType</a></li><li data-type='method'><a href="Release.html#facet">facet</a></li><li data-type='method'><a href="Release.html#facets">facets</a></li><li data-type='method'><a href="Release.html#localTerm">localTerm</a></li><li data-type='method'><a href="Release.html#localTerms">localTerms</a></li><li data-type='method'><a href="Release.html#namespace">namespace</a></li><li data-type='method'><a href="Release.html#namespaces">namespaces</a></li><li data-type='method'><a href="Release.html#properties">properties</a></li><li data-type='method'><a href="Release.html#property">property</a></li><li data-type='method'><a href="Release.html#subProperties">subProperties</a></li><li data-type='method'><a href="Release.html#subProperty">subProperty</a></li><li data-type='method'><a href="Release.html#type">type</a></li><li data-type='method'><a href="Release.html#types">types</a></li></ul></li><li><a href="ReleaseObject.html">ReleaseObject</a></li><li><a href="SourceDataSetInterface.html">SourceDataSetInterface</a><ul class='methods'><li data-type='method'><a href="SourceDataSetInterface.html#add">add</a></li><li data-type='method'><a href="SourceDataSetInterface.html#delete">delete</a></li><li data-type='method'><a href="SourceDataSetInterface.html#edit">edit</a></li><li data-type='method'><a href="SourceDataSetInterface.html#find">find</a></li><li data-type='method'><a href="SourceDataSetInterface.html#get">get</a></li><li data-type='method'><a href="SourceDataSetInterface.html#history">history</a></li></ul></li><li><a href="SubProperty.html">SubProperty</a><ul class='methods'><li data-type='method'><a href="SubProperty.html#.route">route</a></li><li data-type='method'><a href="SubProperty.html#namespace">namespace</a></li></ul></li><li><a href="Transaction.html">Transaction</a></li><li><a href="Type.html">Type</a><ul class='methods'><li data-type='method'><a href="Type.html#createFacet">createFacet</a></li><li data-type='method'><a href="Type.html#createSubProperty">createSubProperty</a></li><li data-type='method'><a href="Type.html#facet">facet</a></li><li data-type='method'><a href="Type.html#facets">facets</a></li><li data-type='method'><a href="Type.html#subProperties">subProperties</a></li><li data-type='method'><a href="Type.html#subProperty">subProperty</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">src/niem-object/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
let Change = require("../interfaces/source/change/index");
let NIEMModelSource = require("../interfaces/source/index");

let { SourceDataSet } = NIEMModelSource;

/**
 * Commonalities of NIEM components and other items.
 */
class NIEMObject {

  constructor() {

    /**
     * The object ID from the latest source transaction.
     * @type {string}
     */
    this.lastTransactionID;

    /**
     * The corresponding object ID from the previous release.
     * @type {string}
     */
    this.migrationID;

    /**
     * A file name, a spreadsheet tab, etc.
     * @type {String}
     */
    this.input_location;

    /**
     * A line number, a spreadsheet row, etc.
     * @type {String}
     */
    this.input_line;

  }

  /**
   * @type {SourceDataSet&lt;NIEMObject>}
   */
  get sourceDataSet() {
    return undefined;
  }

  /**
   * An object ID.
   * May be overwritten to return a new kind of value, like a database id.
   */
  get id() {
    return this.route;
  }

  /**
   * A readable label for a NIEM object.
   * May not be unique in certain cases (non-unique codes) or across releases.
   *
   * @example "niem model"
   * @example "lapd arrestReport"
   *
   * @example Property label "nc:PersonHairColorCode"
   * @example Type-Contains-Property label "nc:PersonType - nc:PersonBirthDate"
   * @example Facet label "ncic:HAIRCodeSimpleType - enum BLK"
   */
  get label() {
    return undefined;
  }

  static route() {
    return undefined;
  }

  /**
   * An ID that distinguishes objects across different users, models, and releases.
   * Not unique for duplicate facets.
   *
   * @example "/niem/model"
   * @example "/lapd/arrestReport"
   */
  get route() {
    return undefined;
  }

  get identifiers() {
    return {};
  }

  toJSON() {
    return {
      id: this.id,
      userKey: this.userKey,
      modelKey: this.modelKey,
      migrationID: this.migrationID,
      transactionID: this.lastTransactionID,
      input_location: this.input_location,
      input_line: this.input_line
    };
  }

  /**
   * @param {String} location
   * @param {String} line
   */
  updateSource(location, line) {
    this.input_location = location;
    this.input_line = line;
  }

  /**
   * Check for values in all required identifier fields
   */
  hasBaselineFields() {
    for (let field in this.identifiers) {
      if (! this.identifiers[field]) {
        return false;
      }
    }
    return true;
  }

  /**
   * Checks that a NIEM object has unique identifiers needed for source operations.
   *
   * @example "Throws error if a type does not have a name."
   * @example "Returns if a type has a userKey, modelKey, releaseKey, prefix, and name."
   * @throws {Error}
   */
  async checkBaselineFields() {
    if (! this.hasBaselineFields()) {
      throw new Error("Required fields are missing");
    }
  }

  /**
   * Checks that an object ID does or does not exist in the source.
   *
   * @example "False if a type does not have a name."
   * @example "False if a type has the same name as another type in the namespace."
   * @example "True if a type has a unique qname within its release."
   *
   * @param {"exists"|"available"} expectedStatus
   * @param {string} id
   *
   * @throws {Error} Required fields are missing
   * @throws {Error} Required fields are not unique
   * @throws {Error} No NIEM source data implementation
   */
  async checkSourceID(expectedStatus, id) {

    if (! this.source || ! this.sourceDataSet) {
      throw new Error("No NIEM source data implementation");
    }

    // Check for an existing object with the given id
    let match = await this.sourceDataSet.get(id);

    if (expectedStatus == "available" &amp;&amp; match) {
      throw new Error("Required fields are not unique");
    }

    if (expectedStatus == "exists" &amp;&amp; ! match ) {
      throw new Error("Object not found");
    }

  }

  /**
   * Save changes to the object.
   * @param {Change} change
   */
  async add(change) {

    // Check required fields and that object is unique
    await this.checkBaselineFields();
    await this.checkSourceID("available", this.id);

    // Add object
    await this.sourceDataSet.add(this, change);

    // Initialize transaction id
    this.lastTransactionID = this.id;

    return this;
  }

  /**
   * Save changes to the object.
   * @param {Change} change
   */
  async save(change) {

    // Check required fields and that object exists
    await this.checkBaselineFields();
    await this.checkSourceID("exists", this.lastTransactionID);

    // Update object
    await this.sourceDataSet.edit(this, change);

    // Reset transaction id
    this.lastTransactionID = this.id;

    return this;
  }

  /**
   * Deletes the object.
   * @param {Change} change
   */
  async delete(change) {

    // Check that object exists
    await this.checkSourceID("exists", this.lastTransactionID);

    // Remove object from data source
    this.sourceDataSet.delete(this, change);

    return this;
  }

}

module.exports = NIEMObject;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Sun Aug 18 2019 20:06:25 GMT-0400 (Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
